(function(e){function t(t){for(var n,i,s=t[0],c=t[1],l=t[2],p=0,m=[];p<s.length;p++)i=s[p],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&m.push(o[i][0]),o[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);u&&u(t);while(m.length)m.shift()();return r.push.apply(r,l||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],n=!0,s=1;s<a.length;s++){var c=a[s];0!==o[c]&&(n=!1)}n&&(r.splice(t--,1),e=i(i.s=a[0]))}return e}var n={},o={app:0},r=[];function i(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=n,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(a,n,function(t){return e[t]}.bind(null,n));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;r.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},2813:function(e,t,a){},3691:function(e,t,a){},"4ae3":function(e,t,a){"use strict";var n=a("3691"),o=a.n(n);o.a},"56d7":function(e,t,a){"use strict";a.r(t);a("a133"),a("ed0d"),a("f09c"),a("e117");var n=a("2b0e"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},r=[],i={name:"App",components:{}},s=i,c=a("2877"),l=Object(c["a"])(s,o,r,!1,null,null,null),u=l.exports,p=a("4fb5"),m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("van-nav-bar",{attrs:{title:e.curObject.name}}),a("ApplyForm",{attrs:{formData:e.form}})],1)},f=[],d=(a("ecb4"),a("053b"),a("e35a"),a("9cf3"),a("ade3")),h=(a("35d0"),a("0c7e")),g=(a("1281"),a("dc18")),v=(a("475c"),a("9350")),b=(a("8abe"),a("d4bd")),y=(a("c64f"),a("cf6b")),j=(a("4feb"),a("9950")),w=(a("b4c8"),a("ff9b")),_=(a("ba45"),a("5d79")),O=(a("995e"),a("4d3b")),x=(a("b4fb"),a("e18c"),a("5976")),k=a.n(x),S={token:"token",apiUrl:"http://tk.freebie-queen.com",uploadUrl:"http://tk.freebie-queen.com/api/v1/upload/",version:"/v1",login_page:"/api/login",tokenExpire:{access_token:72e5,refresh_token:864e5},ACCESS_TOKEN:"Access-Token",REFRESH_TOKEN:"Refresh-Token",storageOptions:{namespace:"pro__",name:"ls",storage:"local"}},E=function(e){if(e)return window.localStorage.getItem(e)},N=E(S.storageOptions.namespace+S.ACCESS_TOKEN)?E(S.storageOptions.namespace+S.ACCESS_TOKEN):"";function T(e,t,a){return new Promise((function(n,o){k()({headers:{"Content-Type":"application/json;charset=UTF-8"},method:e,url:t,data:"POST"===e||"PUT"===e||"PATCH"===e?a:null,params:"GET"===e||"DELETE"===e?a:null,withCredentials:!1}).then((function(e){console.log(e),n(e.data)})).catch((function(e){console.log(e),o(e)}))}))}k.a.defaults.baseURL="/api",k.a.defaults.timeout=2e4,N&&(N=JSON.parse(N).value,k.a.defaults.headers.common.Authorization="Bearer "+N),console.log(N),k.a.defaults.headers.post["Content-Type"]="application/json",k.a.defaults.headers.put["Content-Type"]="application/json",k.a.interceptors.request.use((function(e){return e.headers.Accept="application/json",e}),(function(e){return Promise.reject(e)})),k.a.interceptors.response.use((function(e){console.log(e);var t=e.data,a=e.status;return{data:t,status:a}}),(function(e){if(console.log(e.response),e.response)return 401===e.response.status&&h["a"].alert({title:"授权失败",message:"企业微信授权失败，请重新打开页面"}).then((function(){window.close()})),Promise.reject(e)}));var D,C={get:function(e,t){return T("GET",e,t)},post:function(e,t){return T("POST",e,t)},put:function(e,t){return T("PUT",e,t)},delete:function(e,t){return T("DELETE",e,t)},patch:function(e,t){return T("PATCH",e,t)}},F=S.version,A=function(e){return C.post("/login/",e)},P=function(e){return C.post("".concat(F,"/upload/"),e)},R=function(e){return C.post("".concat(F,"/project/create"),e)},$=function(e){return C.get("".concat(F,"/project/list"),e)},L=function(e){return C.get("".concat(F,"/project/").concat(e))},z=function(e,t){return C.patch("".concat(F,"/project/audit/").concat(e),t)},I=function(e){return C.get("".concat(F,"/project/right/").concat(e))},q=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{"margin-top":"20px"}},[a("van-form",{on:{submit:e.onSubmit}},[a("van-field",{directives:[{name:"show",rawName:"v-show",value:e.auditNow,expression:"auditNow"}],attrs:{value:e.formData.creator.username,label:"创建人"}}),a("van-field",{directives:[{name:"show",rawName:"v-show",value:e.auditNow,expression:"auditNow"}],attrs:{value:e.formData.create_time,label:"创建时间"}}),a("van-field",{attrs:{name:"category",label:"产品细分类目",rules:[{required:!0,message:"请填写产品细分类目"}]},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}}),a("van-field",{attrs:{name:"model_type",label:"产品型号",rules:[{required:!0,message:"请填写产品型号"}]},model:{value:e.form.model_type,callback:function(t){e.$set(e.form,"model_type",t)},expression:"form.model_type"}}),a("van-field",{attrs:{rows:"5",name:"market_share_analysis",autosize:"",label:"市场大盘容量及市占分析",type:"textarea",rules:[{required:!0,message:"请填写容量及市占分析"}]},model:{value:e.form.market_share_analysis,callback:function(t){e.$set(e.form,"market_share_analysis",t)},expression:"form.market_share_analysis"}},[e._v("> ")]),a("van-field",{attrs:{rows:"5",name:"context_analysis",autosize:"",label:"场景分析",type:"textarea",rules:[{required:!0,message:"请简要描述该产品场景分析"}]},model:{value:e.form.context_analysis,callback:function(t){e.$set(e.form,"context_analysis",t)},expression:"form.context_analysis"}},[e._v("> ")]),a("van-checkbox-group",{directives:[{name:"show",rawName:"v-show",value:!e.auditNow,expression:"!auditNow"}],staticStyle:{padding:"15px",width:"100%"},attrs:{direction:"horizontal",disabled:""},model:{value:e.auditor,callback:function(t){e.auditor=t},expression:"auditor"}},[a("span",{staticStyle:{"margin-right":"10px","font-size":"14px",color:"#646566"}},[e._v("审批 ")]),a("van-checkbox",{attrs:{name:"1"}},[e._v("邓望明")]),a("van-checkbox",{attrs:{name:"2"}},[e._v("杜波")])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.auditNow,expression:"!auditNow"}],staticClass:"van-hairline--bottom"}),a("van-uploader",{directives:[{name:"show",rawName:"v-show",value:!e.auditNow,expression:"!auditNow"}],staticStyle:{padding:"15px",width:"100%"},attrs:{accept:e.acceptType,"max-count":5,"max-size":e.maxSize,"after-read":e.uploadFile,"before-read":e.showReading},on:{oversize:e.onOversize},model:{value:e.uploadFileList,callback:function(t){e.uploadFileList=t},expression:"uploadFileList"}},[a("van-button",{attrs:{icon:"upgrade",type:"primary"}},[e._v("上传文件")])],1),e._l(e.formData.attachments,(function(t,n){return a("div",{key:n,staticStyle:{"text-align":"center","margin-top":"20px","font-size":"14px",cursor:"pointer"},on:{click:function(a){return e.downloadFile(t)}}},[a("van-icon",{directives:[{name:"show",rawName:"v-show",value:e.auditNow,expression:"auditNow"}],key:n,attrs:{name:"newspaper-o",size:"15px"}},[e._v("附件"+e._s(n+1)+" ")])],1)})),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.auditNow,expression:"!auditNow"}],staticStyle:{margin:"16px"}},[a("van-button",{staticStyle:{width:"100%"},attrs:{round:"",block:"",type:"info","native-type":"submit",disabled:e.submitDisable}},[e._v(" 提交 ")])],1)],2)],1)])},K=[],U=(a("fe59"),a("08ba"),a("ac8a"),a("9ec1")),J={name:"ApplyForm",components:(D={},Object(d["a"])(D,O["a"].name,O["a"]),Object(d["a"])(D,w["a"].name,w["a"]),Object(d["a"])(D,j["a"].name,j["a"]),Object(d["a"])(D,y["a"].name,y["a"]),Object(d["a"])(D,b["a"].name,b["a"]),Object(d["a"])(D,U["a"].name,U["a"]),Object(d["a"])(D,v["a"].name,v["a"]),Object(d["a"])(D,g["a"].name,g["a"]),Object(d["a"])(D,h["a"].name,h["a"]),D),props:{formData:{type:Object,default:{}}},mounted:function(){this.formData&&(this.formData.attachments="string"===typeof this.formData.attachments?JSON.parse(this.formData.attachments):[],this.form=this.formData)},data:function(){return{curObject:{name:"发起立项流程"},maxSize:10485760,acceptType:"image/*,.doc,.docx,.pdf,.ppt,.xlsx,.xls",auditor:["1","2"],uploadFileList:[],submitDisable:!1,form:{category:"",model_type:"",context_analysis:"",attachments:[],market_share_analysis:""}}},computed:{auditNow:function(){return Boolean(this.formData.id)}},methods:{onSubmit:function(e){var t=this;if(0===this.uploadFileList.length)return b["a"].fail("请上传附件"),!1;console.log("submit",e),console.log("submit",this.form),this.uploadFileList.forEach((function(e){return t.form.attachments.push(e.file.url),e})),e.attachments=JSON.stringify(this.form.attachments),R(e).then((function(e){console.log(e),h["a"].alert({message:"流程创建成功"}).then((function(){t.resetForm()})).catch((function(e){console.log(e),b["a"].fail("创建出错，请稍候再试")}))}))},resetForm:function(){this.form.category="",this.form.model_type="",this.form.context_analysis="",this.form.market_share_analysis="",this.form.attachments=[],this.uploadFileList=[]},onOversize:function(e){console.log(e),Object(b["a"])("文件大小不能超过 10M")},uploadFile:function(e){var t=this;console.log(e);var a=new FormData;a.append("file",e.file),P(a).then((function(e){if(console.log(e),"ok"!==e.msg)return b["a"].fail(e.msg),!1;var a=t.uploadFileList.pop();a.file.url=e.data.file,t.uploadFileList.push(a),b["a"].success("上传成功"),console.log(t.uploadFileList)})).catch((function(e){console.log(e),b["a"].clear(),b["a"].fail(e.msg)})),this.submitDisable=!1},downloadFile:function(e){console.log(e),window.open(e)},showReading:function(){return this.submitDisable=!0,b["a"].loading({message:"上传中...",forbidClick:!0,duration:1e4}),!0}}},M=J,H=Object(c["a"])(M,q,K,!1,null,"20989098",null),B=H.exports;a("77ad"),a("513c"),a("20a5"),a("84c2"),a("1c2e"),a("f4e3"),a("5e9f"),a("a9af"),a("5530");function G(e,t){n["a"].ls.set(S.ACCESS_TOKEN,e,S.tokenExpire.access_token),n["a"].ls.set(S.REFRESH_TOKEN,t,S.tokenExpire.refresh_token),console.log(n["a"].ls.get(S.ACCESS_TOKEN))}function Q(){return n["a"].ls.get(S.ACCESS_TOKEN)}var V,W,X,Y={name:"Apply",components:(V={},Object(d["a"])(V,O["a"].name,O["a"]),Object(d["a"])(V,_["a"].name,_["a"]),Object(d["a"])(V,w["a"].name,w["a"]),Object(d["a"])(V,j["a"].name,j["a"]),Object(d["a"])(V,y["a"].name,y["a"]),Object(d["a"])(V,b["a"].name,b["a"]),Object(d["a"])(V,v["a"].name,v["a"]),Object(d["a"])(V,g["a"].name,g["a"]),Object(d["a"])(V,h["a"].name,h["a"]),Object(d["a"])(V,"ApplyForm",B),V),data:function(){return{curObject:{name:"发起立项流程"},maxSize:10485760,acceptType:".doc,.docx, .pdf, .ppt, .jpg, .jpeg, .png",auditor:["1","2"],form:{category:"",creator:{},model_type:"",context_analysis:"",attachments:[],market_share_analysis:""}}},mounted:function(){this.test()},methods:{getUserInfo:function(){var e,t=/code=.+/.exec(window.location.search);if(t){var a=t[0].substr(5),n=a.indexOf("&");e=-1!==n?a.substr(0,n):a,A({code:e}).then((function(e){console.log(e);var t=e.data.access_token,a=e.data.access_token;G(t,a),console.log()}))}},test:function(){var e="41234123412",t="4123412341234124";G(e,t),console.log(n["a"].ls.get("Access-Token")),console.log(n["a"].ls.get("Refresh-Token")),console.log(Q())}}},Z=Y,ee=Object(c["a"])(Z,m,f,!1,null,"6a7af260",null),te=ee.exports,ae=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("van-nav-bar",{attrs:{title:e.curObject.name}}),a("van-skeleton",{staticClass:"skeleton",attrs:{title:"",row:15,loading:e.loading}},[a("div",[a("van-cell-group",e._l(e.projects,(function(t,n){return a("van-cell",{key:n,attrs:{icon:"records",title:t.model_type,label:t.creator.username,"is-link":""},on:{click:function(a){return e.goCheck(t)}}},[t.result?a("van-tag",{attrs:{type:"success"}},[e._v("已完成")]):a("van-tag",{attrs:{type:"warning"}},[e._v("未审批")])],1)})),1)],1)]),a("van-pagination",{staticStyle:{position:"absolute",bottom:"10px",margin:"auto",width:"100%"},attrs:{"total-items":e.pagination.total,"items-per-page":e.pagination.num},on:{change:e.getData},model:{value:e.pagination.page,callback:function(t){e.$set(e.pagination,"page",t)},expression:"pagination.page"}})],1)},ne=[],oe=(a("40f7"),a("bd4d")),re=(a("bc88"),a("dc1e")),ie=(a("e37b"),a("841e")),se=(a("76f5"),a("ebaf")),ce=(a("49a0"),a("fc4f")),le={name:"AuditList",components:(W={},Object(d["a"])(W,w["a"].name,w["a"]),Object(d["a"])(W,ce["a"].name,ce["a"]),Object(d["a"])(W,se["a"].name,se["a"]),Object(d["a"])(W,ie["a"].name,ie["a"]),Object(d["a"])(W,b["a"].name,b["a"]),Object(d["a"])(W,_["a"].name,_["a"]),Object(d["a"])(W,re["a"].name,re["a"]),Object(d["a"])(W,oe["a"].name,oe["a"]),W),mounted:function(){this.getData()},data:function(){return{curObject:{name:"立项申请列表"},pagination:{num:10,page:1,total:0},projects:[],loading:!0}},methods:{getData:function(){var e=this,t={num:this.pagination.num,page:this.pagination.page};$(t).then((function(t){console.log(t),e.projects=t.results,e.pagination.total=t.count,setTimeout((function(){e.loading=!1}),500)}))},change:function(e){console.log(e)},goCheck:function(e){this.$router.push({name:"product-audit",params:{projectID:e.id}})}}},ue=le,pe=(a("b2af"),Object(c["a"])(ue,ae,ne,!1,null,"2ce30776",null)),me=pe.exports,fe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("van-nav-bar",{attrs:{title:e.curObject.name,"left-text":"返回","left-arrow":""},on:{"click-left":e.onClickLeft}}),a("van-skeleton",{staticClass:"skeleton",attrs:{title:"",row:15,loading:e.loading}},[a("ApplyForm",{attrs:{formData:e.formData}}),a("div",{staticClass:"action"},[e.toggleReject?a("div",[a("van-field",{attrs:{rows:"3",name:"memo",autosize:"",autofocus:!0,label:"否决意见",type:"textarea",placeholder:"请填写否决意见"},model:{value:e.memo,callback:function(t){e.memo=t},expression:"memo"}}),a("div",{staticClass:"van-hairline--bottom",staticStyle:{"margin-bottom":"20px"}}),a("van-button",{attrs:{type:"primary"},on:{click:function(t){e.toggleReject=!1}}},[e._v(" 取消")]),a("van-button",{staticStyle:{"margin-left":"35px"},attrs:{type:"info"},on:{click:e.reject}},[e._v("确认")])],1):a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:e.ownRight,expression:"ownRight"}]},[a("van-button",{attrs:{type:"primary"},on:{click:e.pass}},[e._v(" 同意")]),a("van-button",{staticStyle:{"margin-left":"35px"},attrs:{type:"info"},on:{click:function(t){e.toggleReject=!0}}},[e._v("否决")])],1)])])],1)],1)},de=[],he={name:"Audit",components:(X={ApplyForm:B},Object(d["a"])(X,_["a"].name,_["a"]),Object(d["a"])(X,j["a"].name,j["a"]),Object(d["a"])(X,w["a"].name,w["a"]),Object(d["a"])(X,oe["a"].name,oe["a"]),Object(d["a"])(X,h["a"].name,h["a"]),Object(d["a"])(X,b["a"].name,b["a"]),X),data:function(){return{toggleReject:!1,ownRight:!1,memo:"",curObject:{name:"审批立项申请"},loading:!0,projectID:0,formData:{}}},mounted:function(){var e=this,t=this.$route.params;console.log(t),void 0!==t.projectID?(this.projectID=t.projectID,this.getProject(t.projectID)):h["a"].alert({message:"项目链接错误"}).then((function(){e.$router.push({name:"audit-list"})}))},methods:{getProject:function(e){var t=this;L(e).then((function(a){console.log(a),I(e).then((function(e){e.data&&(t.ownRight=!0)})),t.formData=a.data,setTimeout((function(){t.loading=!1}),500)}))},onClickLeft:function(){this.$router.push({name:"audit-list"})},pass:function(){var e=this;h["a"].confirm({title:"同意该产品立项",message:""}).then((function(){e.handleAudit(!0)})).catch((function(){return!1}))},reject:function(){if(!this.memo)return Object(b["a"])("请填写否决意见"),!1;this.handleAudit(!1)},handleAudit:function(e){var t=this,a={is_accept:e,memo:this.memo};z(this.projectID,a).then((function(e){b["a"].success({message:"审批已完成",onClose:function(){t.$router.push({name:"audit-list"})}})})).catch((function(e){t.requestFail(e)}))},requestFail:function(e){console.log(e)}}},ge=he,ve=(a("4ae3"),Object(c["a"])(ge,fe,de,!1,null,"bf0e4fd6",null)),be=ve.exports,ye=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("van-empty",{attrs:{description:"页面不存在"}})},je=[],we=(a("cd28"),a("7a86")),_e={name:"NotFound",components:Object(d["a"])({},we["a"].name,we["a"])},Oe=_e,xe=Object(c["a"])(Oe,ye,je,!1,null,"277e7832",null),ke=xe.exports,Se=[{path:"/product/flow",name:"product-flow",component:te},{path:"/product/auditlist",name:"audit-list",component:me},{path:"/product/audit/:projectID([1-9]\\d*)?",name:"product-audit",component:be},{path:"*",name:"notFound",component:ke}];n["a"].use(p["a"]);var Ee=new p["a"]({mode:"history",routes:Se}),Ne=Ee,Te=a("8505"),De=a.n(Te);n["a"].use(De.a,S.storageOptions),n["a"].config.productionTip=!1,new n["a"]({router:Ne,components:{App:u},render:function(e){return e(u)}}).$mount("#app")},b2af:function(e,t,a){"use strict";var n=a("2813"),o=a.n(n);o.a}});
//# sourceMappingURL=app.5bf1eb09.js.map