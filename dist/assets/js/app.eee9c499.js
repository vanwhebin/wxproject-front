(function(t){function e(e){for(var o,r,s=e[0],l=e[1],c=e[2],p=0,d=[];p<s.length;p++)r=s[p],Object.prototype.hasOwnProperty.call(n,r)&&n[r]&&d.push(n[r][0]),n[r]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(t[o]=l[o]);u&&u(e);while(d.length)d.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var t,e=0;e<i.length;e++){for(var a=i[e],o=!0,s=1;s<a.length;s++){var l=a[s];0!==n[l]&&(o=!1)}o&&(i.splice(e--,1),t=r(r.s=a[0]))}return t}var o={},n={app:0},i=[];function r(e){if(o[e])return o[e].exports;var a=o[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=o,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(a,o,function(e){return t[e]}.bind(null,o));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var u=l;i.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"034f":function(t,e,a){"use strict";var o=a("85ec"),n=a.n(o);n.a},"0bd5":function(t,e,a){},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var o=a("2b0e"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},i=[],r={name:"App",components:{}},s=r,l=(a("034f"),a("2877")),c=Object(l["a"])(s,n,i,!1,null,null,null),u=c.exports,p=a("8c4f"),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("van-nav-bar",{attrs:{title:t.curObject.name}}),a("ApplyForm",{attrs:{formData:t.form}})],1)},m=[],f=(a("b0c0"),a("ac1f"),a("841c"),a("1276"),a("ade3")),h=(a("e17f"),a("2241")),g=(a("a909"),a("3acc")),_=(a("3c32"),a("417e")),v=(a("e7e5"),a("d399")),b=(a("e930"),a("8f80")),w=(a("be7f"),a("565f")),y=(a("66b9"),a("b650")),k=(a("5246"),a("6b41")),S=(a("38d5"),a("772a")),x=(a("99af"),a("d3b7"),a("bc3a")),D=a.n(x),T={token:"token",apiUrl:"http://tk.freebie-queen.com",uploadUrl:"http://tk.freebie-queen.com/api/v1/upload/",version:"/v1",login_page:"/api/login",tokenExpire:{access_token:72e5,refresh_token:864e5},ACCESS_TOKEN:"Access-Token",REFRESH_TOKEN:"Refresh-Token",storageOptions:{namespace:"pro__",name:"ls",storage:"local"}},E=function(t,e){t&&("string"!==typeof e&&(e=JSON.stringify(e)),window.sessionStorage.setItem(t,e))},O=function(t){if(t)return window.sessionStorage.getItem(t)};function j(t,e,a){return new Promise((function(o,n){D()({headers:{"Content-Type":"application/json;charset=UTF-8"},method:t,url:e,data:"POST"===t||"PUT"===t||"PATCH"===t?a:null,params:"GET"===t||"DELETE"===t?a:null,withCredentials:!1}).then((function(t){console.log(t),o(t.data)})).catch((function(t){console.log(t),n(t)}))}))}D.a.defaults.baseURL="/api",D.a.defaults.timeout=2e4,D.a.defaults.headers.post["Content-Type"]="application/json",D.a.defaults.headers.put["Content-Type"]="application/json",D.a.interceptors.request.use((function(t){t.headers.Accept="application/json";var e=O(T.ACCESS_TOKEN);return console.log(e),e&&(t.headers.Authorization="Bearer "+e),t}),(function(t){return Promise.reject(t)})),D.a.interceptors.response.use((function(t){console.log(t);var e=t.data,a=t.status;return{data:e,status:a}}),(function(t){if(console.log(t.response),t.response)return 401===t.response.status&&h["a"].alert({title:"授权失败",message:"企业微信授权失败，请重新打开页面"}).then((function(){window.close()})),Promise.reject(t)}));var F,I,A,C,L={get:function(t,e){return j("GET",t,e)},post:function(t,e){return j("POST",t,e)},put:function(t,e){return j("PUT",t,e)},delete:function(t,e){return j("DELETE",t,e)},patch:function(t,e){return j("PATCH",t,e)}},N=T.version,R=function(t){return L.post("/login/",t)},U=function(t){return L.post("".concat(N,"/upload/"),t)},$=function(t){return L.post("".concat(N,"/project/create"),t)},q=function(t){return L.get("".concat(N,"/project/list"),t)},M=function(t){return L.get("".concat(N,"/project/").concat(t))},K=function(t,e){return L.patch("".concat(N,"/project/audit/").concat(t),e)},G=function(t){return L.get("".concat(N,"/project/right/").concat(t))},B=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticStyle:{"margin-top":"20px"}},[a("van-steps",{attrs:{active:t.active,"active-color":t.activeColor,"active-icon":t.activeIcon}},t._l(t.stepList,(function(e,o){return a("van-step",{key:o},[t._v(t._s(e))])})),1),a("van-field",{directives:[{name:"show",rawName:"v-show",value:t.rejectReason,expression:"rejectReason"}],attrs:{readonly:Boolean(t.rejectReason),label:"驳回意见: ",value:t.rejectReason,type:"textarea",row:"2",autosize:""}}),a("van-form",{staticClass:"form",on:{submit:t.onSubmit}},[t.auditNow?a("van-field",{attrs:{readonly:t.auditNow,value:t.formData.creator_name,label:"创建人"}}):t._e(),t.auditNow?a("van-field",{attrs:{readonly:t.auditNow,value:t.formData.create_time,label:"创建时间"}}):t._e(),a("div",{staticClass:"field-label"},[a("span",{staticClass:"field-label-require"},[t._v("*")]),t._v("产品细分类目")]),a("van-field",{attrs:{readonly:t.auditNow,placeholder:"请填写产品细分类目",name:"category",rules:[{required:!0}]},model:{value:t.form.category,callback:function(e){t.$set(t.form,"category",e)},expression:"form.category"}}),a("div",{staticClass:"field-label"},[a("span",{staticClass:"field-label-require"},[t._v("*")]),t._v("市场容量")]),a("van-field",{attrs:{readonly:t.auditNow,placeholder:"请填写产品型号",name:"type"},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},[a("div",{attrs:{slot:"input"},slot:"input"},[a("van-radio-group",{attrs:{direction:"horizontal",disabled:t.auditNow},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},[a("van-radio",{attrs:{name:"1"}},[t._v("小于300万美金")]),a("van-radio",{attrs:{name:"2"}},[t._v("大于等于300万美金")])],1)],1)]),a("div",{staticClass:"field-label"},[a("span",{staticClass:"field-label-require"},[t._v("*")]),t._v("产品型号")]),a("van-field",{attrs:{readonly:t.auditNow,placeholder:"请填写产品型号",name:"model_type",rules:[{required:!0}]},model:{value:t.form.model_type,callback:function(e){t.$set(t.form,"model_type",e)},expression:"form.model_type"}}),a("div",{staticClass:"field-label"},[a("span",{staticClass:"field-label-require"},[t._v("*")]),t._v("市场大盘容量及市占分析")]),a("van-field",{attrs:{readonly:t.auditNow,placeholder:"请填写容量及市占分析",rows:"3",name:"market_share_analysis",autosize:"",type:"textarea",rules:[{required:!0}]},model:{value:t.form.market_share_analysis,callback:function(e){t.$set(t.form,"market_share_analysis",e)},expression:"form.market_share_analysis"}},[t._v("> ")]),a("div",{staticClass:"field-label"},[a("span",{staticClass:"field-label-require"},[t._v("*")]),t._v("产品主要参数和配置")]),a("van-field",{attrs:{readonly:t.auditNow,placeholder:"请描述该产品主要参数和配置",rows:"3",name:"context_analysis",autosize:"",type:"textarea",rules:[{required:!0}]},model:{value:t.form.context_analysis,callback:function(e){t.$set(t.form,"context_analysis",e)},expression:"form.context_analysis"}},[t._v("> ")]),a("div",{staticClass:"field-label"},[a("span",{staticClass:"field-label-require"},[t._v("*")]),t._v("首单数量")]),a("van-field",{attrs:{readonly:t.auditNow,type:"number",maxlength:"10",placeholder:"请填写首单数量",name:"first_orders",rules:[{required:!0}]},model:{value:t.form.first_orders,callback:function(e){t.$set(t.form,"first_orders",e)},expression:"form.first_orders"}}),a("div",{staticClass:"field-label"},[a("span",{staticClass:"field-label-require"},[t._v("*")]),t._v("月销量预测")]),a("van-field",{attrs:{readonly:t.auditNow,placeholder:"请简要描述该产品月销量预测",rows:"3",name:"orders_estimate",autosize:"",type:"textarea",rules:[{required:!0}]},model:{value:t.form.orders_estimate,callback:function(e){t.$set(t.form,"orders_estimate",e)},expression:"form.orders_estimate"}}),a("van-field",{directives:[{name:"show",rawName:"v-show",value:!t.auditNow,expression:"!auditNow"}],attrs:{readonly:!0,center:"",name:"roi_report",required:!0,label:"ROI报告",placeholder:"请上传ROI分析报告",rules:[{required:!0}]},scopedSlots:t._u([{key:"button",fn:function(){return[a("van-uploader",{staticStyle:{padding:"15px",width:"100%"},attrs:{accept:t.acceptType,"max-size":t.maxSize,"max-count":1,"after-read":t.uploadROIFile,"before-read":t.showReading},on:{oversize:t.onOversize},model:{value:t.uploadFileROIList,callback:function(e){t.uploadFileROIList=e},expression:"uploadFileROIList"}},[a("van-button",{attrs:{size:"small",type:"primary"}},[t._v("上传")])],1)]},proxy:!0}]),model:{value:t.roi_report,callback:function(e){t.roi_report=e},expression:"roi_report"}}),a("van-uploader",{directives:[{name:"show",rawName:"v-show",value:!t.auditNow,expression:"!auditNow"}],staticStyle:{padding:"15px",width:"100%"},attrs:{accept:t.acceptType,"max-count":5,"max-size":t.maxSize,"after-read":t.uploadOtherFile,"before-read":t.showReading},on:{oversize:t.onOversize},model:{value:t.uploadFileList,callback:function(e){t.uploadFileList=e},expression:"uploadFileList"}},[a("van-button",{attrs:{icon:"upgrade",type:"default"}},[t._v("其他附件")])],1),a("div",{staticStyle:{"text-align":"center","margin-top":"20px","font-size":"14px",cursor:"pointer","margin-bottom":"20px"},on:{click:function(e){return t.downloadFile(t.formData.roi_report)}}},[a("van-icon",{directives:[{name:"show",rawName:"v-show",value:t.auditNow,expression:"auditNow"}],attrs:{name:"newspaper-o",size:"15px"}},[t._v("ROI分析")])],1),t._l(t.formData.attachments,(function(e,o){return a("div",{key:o,staticStyle:{"text-align":"center","margin-top":"20px","font-size":"14px",cursor:"pointer","margin-bottom":"20px"},on:{click:function(a){return t.downloadFile(e.url)}}},[a("van-icon",{directives:[{name:"show",rawName:"v-show",value:t.auditNow,expression:"auditNow"}],key:o,attrs:{name:"newspaper-o",size:"15px"}},[t._v(t._s(e.name)+" ")])],1)})),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.auditNow,expression:"!auditNow"}],staticStyle:{margin:"16px"}},[a("van-button",{staticStyle:{width:"100%"},attrs:{round:"",block:"",type:"info","native-type":"submit",disabled:t.submitDisable}},[t._v(" 提交 ")])],1)],2)],1)])},z=[],H=(a("4160"),a("159b"),a("4ddd"),a("9f14")),P=(a("a44c"),a("e27c")),W=(a("c3a6"),a("ad06")),X=(a("77f8"),a("dc0f")),Y=(a("1f87"),a("510b")),J={name:"ApplyForm",components:(F={},Object(f["a"])(F,S["a"].name,S["a"]),Object(f["a"])(F,y["a"].name,y["a"]),Object(f["a"])(F,w["a"].name,w["a"]),Object(f["a"])(F,b["a"].name,b["a"]),Object(f["a"])(F,Y["a"].name,Y["a"]),Object(f["a"])(F,X["a"].name,X["a"]),Object(f["a"])(F,v["a"].name,v["a"]),Object(f["a"])(F,W["a"].name,W["a"]),Object(f["a"])(F,_["a"].name,_["a"]),Object(f["a"])(F,P["a"].name,P["a"]),Object(f["a"])(F,H["a"].name,H["a"]),Object(f["a"])(F,g["a"].name,g["a"]),Object(f["a"])(F,h["a"].name,h["a"]),F),props:{formData:{type:Object,default:{}}},data:function(){return{curObject:{name:"发起立项流程"},maxSize:10485760,acceptType:"image/*,.doc,.docx,.pdf,.ppt,.xlsx,.xls",auditor:["1","2"],uploadFileList:[],uploadFileROIList:[],submitDisable:!1,roi_report:"",form:{category:"",model_type:"",type:"",roi_report:"",first_orders:"",orders_estimate:"",context_analysis:"",attachments:[],create_time:"",market_share_analysis:""},stepList:["提交申请","流程审批","审批结果"],rejectReason:"",activeColor:"#07c160",activeIcon:"checked"}},mounted:function(){if(console.log(this.formData),this.formData.id){this.stepList=["提交申请"],this.formData.attachments="string"===typeof this.formData.attachments?JSON.parse(this.formData.attachments):[],this.form=this.formData;for(var t=this.formData.result,e=0;e<t.length;e++)if(this.stepList.push("审批（".concat(t[e].auditor,"）")),"reject"===t[e].is_accept)return this.stepList.push("立项申请不通过"),this.rejectReason=t[e].memo,this.activeColor="#C12021",this.activeIcon="clear",!0;this.formData.is_done?this.stepList.push("立项申请通过"):this.stepList.push("审批结果")}},computed:{auditNow:function(){return Boolean(this.formData.id)},active:function(){if(this.formData.id){for(var t=this.formData.result,e=0;e<t.length;e++){if("reject"===t[e].is_accept)return this.stepList.length-1;if(null===t[e].is_accept)return this.activeColor="#468EFF",this.activeIcon="clock",e+1}return this.stepList.length-1}return 0}},methods:{onSubmit:function(t){var e=this;return v["a"].loading("正在执行，请稍侯..."),console.log("submit",t),console.log("submit",this.form),this.uploadFileList.length>0&&this.uploadFileList.forEach((function(t){return e.form.attachments.push({name:t.file.name,url:t.file.url}),t})),this.roi_report.length>0&&this.form.roi_report?(t.roi_report=this.form.roi_report,t.type?(t.attachments=JSON.stringify(this.form.attachments),void $(t).then((function(t){console.log(t),h["a"].alert({message:"流程创建成功"}).then((function(){e.resetForm()})).catch((function(t){console.log(t),v["a"].fail("创建出错，请稍候再试")}))}))):(v["a"].fail("请选择市场容量"),!1)):(v["a"].fail("请上传ROI分析"),!1)},resetForm:function(){this.form.category="",this.form.model_type="",this.form.type="",this.form.first_orders="",this.form.orders_estimate="",this.form.context_analysis="",this.form.market_share_analysis="",this.form.attachments=[],this.uploadFileList=[],this.uploadFileROIList=[],this.roi_report=""},onOversize:function(t){console.log(t),Object(v["a"])("文件大小不能超过 10M")},uploadROIFile:function(t){var e=this;this.uploadFile(t,(function(t){if(console.log(t),t){var a=e.uploadFileROIList.pop();a.file.url=t.file,e.uploadFileROIList.push(a),e.form.roi_report=t.file,e.roi_report="   ",console.log(e.form)}}))},uploadOtherFile:function(t){var e=this;this.uploadFile(t,(function(t){if(console.log(t),t){var a=e.uploadFileList.pop();a.file.url=t.file,e.uploadFileList.push(a)}}))},uploadFile:function(t,e){var a=this;console.log(t);var o=new FormData;o.append("file",t.file),U(o).then((function(t){if(console.log(t),"ok"!==t.msg)return v["a"].fail(t.msg),!1;a.submitDisable=!1,v["a"].success("上传成功"),e(t.data)})).catch((function(t){return console.log(t),v["a"].fail(t.msg),!1}))},downloadFile:function(t){console.log(t),window.open(t)},showReading:function(){return this.submitDisable=!0,v["a"].loading({message:"上传中...",forbidClick:!0,duration:1e4}),!0}}},V=J,Q=(a("dbac"),Object(l["a"])(V,B,z,!1,null,"019108ee",null)),Z=Q.exports,tt={name:"Apply",components:(I={},Object(f["a"])(I,S["a"].name,S["a"]),Object(f["a"])(I,k["a"].name,k["a"]),Object(f["a"])(I,y["a"].name,y["a"]),Object(f["a"])(I,w["a"].name,w["a"]),Object(f["a"])(I,b["a"].name,b["a"]),Object(f["a"])(I,v["a"].name,v["a"]),Object(f["a"])(I,_["a"].name,_["a"]),Object(f["a"])(I,g["a"].name,g["a"]),Object(f["a"])(I,h["a"].name,h["a"]),Object(f["a"])(I,"ApplyForm",Z),I),data:function(){return{curObject:{name:"发起立项流程"},maxSize:10485760,acceptType:".doc,.docx, .pdf, .ppt, .jpg, .jpeg, .png",auditor:["1","2"],form:{category:"",creator:{},model_type:"",context_analysis:"",attachments:[],market_share_analysis:""}}},mounted:function(){this.getUserInfo()},methods:{getUserInfo:function(){var t,e,a=/code=.+/.exec(window.location.search);if(a){var o=a[0].split("&");t=o[0].split("=")[1],e=o[1].split("=")[1],R({code:t,state:e}).then((function(t){console.log(t);var e=t.data.access_token;E(T.ACCESS_TOKEN,e)}))}}}},et=tt,at=Object(l["a"])(et,d,m,!1,null,"35cad182",null),ot=at.exports,nt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("van-nav-bar",{attrs:{title:t.curObject.name}}),a("van-skeleton",{staticClass:"skeleton",attrs:{title:"",row:15,loading:t.loading}},[t.projects?a("div",{staticStyle:{"margin-bottom":"50px"}},[a("van-cell-group",t._l(t.projects,(function(e,o){return a("van-cell",{key:o,attrs:{icon:"records",title:e.model_type,label:e.creator_name,"is-link":""},on:{click:function(a){return t.goCheck(e)}}},[e.result?a("van-tag",{attrs:{type:"success"}},[t._v("已完成")]):a("van-tag",{attrs:{type:"warning"}},[t._v("未审批")])],1)})),1)],1):a("div",[a("van-empty",{attrs:{description:"数据为空"}})],1)]),a("van-pagination",{staticStyle:{position:"fixed",bottom:"5px",width:"100%"},attrs:{"total-items":t.pagination.total,"items-per-page":t.pagination.num},on:{change:t.getData},model:{value:t.pagination.page,callback:function(e){t.$set(t.pagination,"page",e)},expression:"pagination.page"}})],1)},it=[],rt=(a("0209"),a("7d5e")),st=(a("6a39"),a("f240")),lt=(a("5f1a"),a("a3e2")),ct=(a("0653"),a("34e9")),ut=(a("c194"),a("7744")),pt=(a("91d5"),a("f0ca")),dt={name:"AuditList",components:(A={},Object(f["a"])(A,pt["a"].name,pt["a"]),Object(f["a"])(A,y["a"].name,y["a"]),Object(f["a"])(A,ut["a"].name,ut["a"]),Object(f["a"])(A,ct["a"].name,ct["a"]),Object(f["a"])(A,lt["a"].name,lt["a"]),Object(f["a"])(A,v["a"].name,v["a"]),Object(f["a"])(A,k["a"].name,k["a"]),Object(f["a"])(A,st["a"].name,st["a"]),Object(f["a"])(A,rt["a"].name,rt["a"]),A),mounted:function(){O(T.ACCESS_TOKEN)?this.getData():this.getUserInfo()},data:function(){return{curObject:{name:"立项申请列表"},pagination:{num:10,page:1,total:0},projects:[],loading:!0}},methods:{getData:function(){var t=this,e={num:this.pagination.num,page:this.pagination.page};q(e).then((function(e){console.log(e),t.projects=e.results,t.pagination.total=e.count,setTimeout((function(){t.loading=!1}),500)}))},getUserInfo:function(){var t,e,a=this,o=/code=.+/.exec(window.location.search);if(o){var n=o[0].split("&");t=n[0].split("=")[1],e=n[1].split("=")[1],R({code:t,state:e}).then((function(t){console.log(t);var e=t.data.access_token;E(T.ACCESS_TOKEN,e),a.getData()}))}},goCheck:function(t){this.$router.push({name:"product-audit",params:{projectID:t.id}})}}},mt=dt,ft=(a("6f98"),Object(l["a"])(mt,nt,it,!1,null,"0d754dbf",null)),ht=ft.exports,gt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{"margin-bottom":"35px"}},[a("van-nav-bar",{directives:[{name:"show",rawName:"v-show",value:t.ownRight,expression:"ownRight"}],attrs:{title:t.curObject.name,"left-text":"返回","left-arrow":""},on:{"click-left":t.onClickLeft}}),a("van-skeleton",{staticClass:"skeleton",attrs:{title:"",row:15,loading:t.loading}},[a("ApplyForm",{attrs:{formData:t.formData}}),a("div",{staticClass:"action"},[t.toggleReject?a("div",[a("van-field",{attrs:{rows:"3",name:"memo",autosize:"",autofocus:!0,label:"否决意见",type:"textarea",placeholder:"请填写否决意见"},model:{value:t.memo,callback:function(e){t.memo=e},expression:"memo"}}),a("div",{staticClass:"van-hairline--bottom",staticStyle:{"margin-bottom":"20px"}}),a("van-button",{attrs:{type:"primary"},on:{click:function(e){t.toggleReject=!1}}},[t._v(" 取消")]),a("van-button",{staticStyle:{"margin-left":"35px"},attrs:{type:"info"},on:{click:t.reject}},[t._v("确认")])],1):a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:t.ownRight,expression:"ownRight"}]},[a("van-button",{attrs:{type:"primary"},on:{click:t.pass}},[t._v(" 同意")]),a("van-button",{staticStyle:{"margin-left":"35px"},attrs:{type:"info"},on:{click:function(e){t.toggleReject=!0}}},[t._v("否决")])],1)])])],1)],1)},_t=[],vt={name:"Audit",components:(C={ApplyForm:Z},Object(f["a"])(C,k["a"].name,k["a"]),Object(f["a"])(C,w["a"].name,w["a"]),Object(f["a"])(C,y["a"].name,y["a"]),Object(f["a"])(C,rt["a"].name,rt["a"]),Object(f["a"])(C,h["a"].name,h["a"]),Object(f["a"])(C,v["a"].name,v["a"]),C),data:function(){return{toggleReject:!1,ownRight:!1,memo:"",curObject:{name:"审批立项申请"},loading:!0,projectID:0,formData:{}}},mounted:function(){var t=this,e=this.$route.params;console.log(e),void 0!==e.projectID?(this.projectID=e.projectID,O(T.ACCESS_TOKEN)?this.getProject(this.projectID):this.getUserInfo()):h["a"].alert({message:"项目链接错误"}).then((function(){t.$router.push({name:"audit-list"})}))},methods:{getUserInfo:function(){var t,e,a=this,o=/code=.+/.exec(window.location.search);if(o){var n=o[0].split("&");t=n[0].split("=")[1],e=n[1].split("=")[1],R({code:t,state:e}).then((function(t){console.log(t);var e=t.data.access_token;E(T.ACCESS_TOKEN,e),a.getProject(a.projectID)}))}},getProject:function(t){var e=this;M(t).then((function(a){console.log(a),G(t).then((function(t){t.data&&(e.ownRight=!0)})),e.formData=a.data,setTimeout((function(){e.loading=!1}),500)}))},onClickLeft:function(){this.$router.push({name:"audit-list"})},pass:function(){var t=this;h["a"].confirm({title:"同意该产品立项",message:""}).then((function(){t.handleAudit(!0)})).catch((function(){return!1}))},reject:function(){if(!this.memo)return Object(v["a"])("请填写否决意见"),!1;this.handleAudit(!1)},handleAudit:function(t){var e=this;v["a"].loading("处理中...");var a={is_accept:t,memo:this.memo};K(this.projectID,a).then((function(t){v["a"].success({message:"审批已完成",onClose:function(){e.$router.push({name:"audit-list"})}})})).catch((function(t){e.requestFail(t)}))},requestFail:function(t){console.log(t)}}},bt=vt,wt=(a("753b"),Object(l["a"])(bt,gt,_t,!1,null,"c9037fe4",null)),yt=wt.exports,kt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("van-empty",{attrs:{description:"页面不存在"}})},St=[],xt={name:"NotFound",components:Object(f["a"])({},pt["a"].name,pt["a"])},Dt=xt,Tt=Object(l["a"])(Dt,kt,St,!1,null,"277e7832",null),Et=Tt.exports,Ot=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",{staticStyle:{margin:"auto","margin-top":"50px","min-height":"500px","margin-left":"10px","margin-right":"10px"}},[a("p",{attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"ios-film-outline"}}),t._v(" 毛利不达标产品审批流程 ")],1),a("a",{attrs:{slot:"extra"},on:{click:function(e){return t.$router.push({name:"sku-apply"})}},slot:"extra"},[t._v("流程列表")]),a("Steps",{attrs:{current:0}},t._l(t.stepArr,(function(t,e){return a("Step",{key:e,attrs:{title:t.title,content:t.desc}})})),1),a("Row",{directives:[{name:"show",rawName:"v-show",value:!t.showTable,expression:"!showTable"}]},[a("Upload",{staticStyle:{"margin-top":"15%"},attrs:{type:"drag","max-size":t.maxSize,"on-exceeded-size":t.onExceedSize,name:"file",headers:t.uploadHeader,accept:".xlsx","on-success":t.afterUpload,"on-error":t.uploadError,action:t.uploadUrl},on:{"before-upload":t.updateHeader}},[a("div",{staticStyle:{padding:"20px 0"}},[a("Icon",{staticStyle:{color:"#3399ff"},attrs:{type:"ios-cloud-upload",size:"52"}}),a("p",[t._v("上传SKU产品数据")])],1)]),a("Row",{staticStyle:{"text-align":"center"}},[a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.downloadTemplate(e)}}},[a("Icon",{attrs:{type:"ios-loop-strong"}}),t._v(" 下载数据模板 ")],1)])],1),a("Row",{directives:[{name:"show",rawName:"v-show",value:t.showTable,expression:"showTable"}],staticStyle:{"margin-top":"25px"}},[a("div",{staticStyle:{"margin-bottom":"5px"}},[a("Button",{on:{click:function(e){return t.handleSelectAll()}}},[t._v(t._s(t.selectAllTitle))]),a("Button",{staticStyle:{float:"right"},attrs:{type:"primary",disabled:t.disableSubmit},on:{click:function(e){return e.preventDefault(),t.submitFlowBtn(e)}}},[t._v(" 发起流程 ")])],1),a("SkuTable",{ref:"skuTable",attrs:{data:t.tableArr,loading:t.tableLoading},on:{onSelect:t.onSelectSkuItem,selectAllCaption:t.selectAllCaption}}),a("Button",{staticStyle:{"margin-top":"5px"},on:{click:function(e){return t.handleSelectAll()}}},[t._v(t._s(t.selectAllTitle))])],1),a("Modal",{ref:"confirmModal",attrs:{"mask-closable":!1,title:"操作提示",loading:t.confirmModal.loading},on:{"on-ok":t.submitFlow},model:{value:t.confirmModal.show,callback:function(e){t.$set(t.confirmModal,"show",e)},expression:"confirmModal.show"}},[a("p",[t._v("确认将已选产品SKU发起审批流程?")])])],1)},jt=[],Ft=(a("a9e3"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Table",{ref:"selection",staticStyle:{"min-height":"500px"},attrs:{border:"",columns:t.columns,data:t.data,loading:t.loading},on:{"on-select":t.onSelect,"on-select-cancel":t.onSelect,"on-select-all":t.onSelect,"on-select-all-cancel":t.onSelect},scopedSlots:t._u([{key:"action",fn:function(e){var o=e.row;return[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small",disabled:o.result},on:{click:function(e){return t.edit(o)}}},[t._v("编辑")])]}}])})}),It=[],At={name:"SkuTable",props:{data:{type:Array,default:[],require:!0},loading:{type:Boolean,default:!1,require:!1},result:{type:Boolean,default:!1,require:!1},isDone:{type:Boolean,default:!1,require:!1}},data:function(){return{status:!1,defaultColumns:[{type:"selection",width:60,align:"center"},{title:"供应商",key:"supplier",align:"center"},{title:"SKU",key:"sku",align:"center"},{title:"型号",key:"model",align:"center"},{title:"SKU名称",key:"title",align:"center"},{title:"是否新品",key:"is_new",align:"center"},{title:"需求单数量",key:"qty",align:"center"},{title:"含税单价",key:"price_with_tax",align:"center"},{title:"含税金额",key:"amount_with_tax",align:"center"},{title:"可售天数",key:"sell_day",align:"center"},{title:"30天销量",key:"qty_within_30",align:"center"},{title:"库存",key:"inventory",align:"center"},{title:"采购在途",key:"coming_inventory",align:"center"},{title:"毛利率",key:"gross_profit_rate",align:"center"},{title:"客退率",key:"return_rate",align:"center"},{title:"备注",key:"memo",align:"center",render:function(t,e){console.log(e);var a=Boolean(e.row.memo)?e.row.memo:"";return t("Poptip",{props:{content:a,transfer:!0,trigger:"hover"}},[t("Button",{props:{type:"default",size:"small"}},"查看")])}},{title:"采购",key:"purchaser",align:"center"}],selected:[]}},computed:{columns:function(){var t=this,e={title:"操作",slot:"action",align:"center"},a={type:"selection",width:60,align:"center"},o=[{title:"SKU",key:"sku",align:"center"},{title:"型号",key:"model",align:"center"},{title:"SKU名称",key:"title",align:"center"},{title:"处理状态",align:"center",key:"result",render:function(e,a){return e("div",[e("Tag",{props:{color:t.isDone?a.row.result?"green":"orange":"purple"}},t.isDone?a.row.result?"通过":"驳回":"待审核")])}}];return this.result?this.isDone?(o.push(e),o.unshift(a),o):o:this.defaultColumns}},methods:{selectAll:function(){this.status=!this.status,this.$refs.selection.selectAll(this.status),this.$emit("selectAllCaption",this.status)},onSelect:function(t,e){var a=this;this.selected=[],t.forEach((function(t){a.selected.push(t.id)})),this.$emit("onSelect",this.selected)},edit:function(t){this.$emit("onEdit",t)}}},Ct=At,Lt=Object(l["a"])(Ct,Ft,It,!1,null,null,null),Nt=Lt.exports,Rt=T.version,Ut=function(t){return L.post("".concat(Rt,"/sku/create"),t)},$t=function(t){return L.get("".concat(Rt,"/sku/list"),t)},qt=function(t){return L.get("".concat(Rt,"/sku/history"),t)},Mt=function(t){return L.get("".concat(Rt,"/sku/").concat(t))},Kt=function(t,e){return L.patch("".concat(Rt,"/sku/audit/").concat(t),e)},Gt=function(t,e){return L.put("".concat(Rt,"/sku/info/").concat(t),e)},Bt=(O(T.ACCESS_TOKEN),{name:"Apply",components:{SkuTable:Nt},data:function(){return{confirmModal:{show:!1,loading:!0},stepArr:[{title:"上传产品列表",desc:"使用模板填充产品列表"},{title:"领导审批",desc:"审批流转"},{title:"流程结束",desc:"企业微信通知"}],selectAllCaptionChoice:{0:"取消全选",1:"全选"},selectAllTitle:"全选",tableLoading:!1,showTable:!1,maxSize:10240,uploadUrl:T.apiUrl+"/api/v1/sku/template",token:"",selectedSkuItemArray:[],uploadHeader:{Authorization:"Bearer "+O(T.ACCESS_TOKEN)},tableArr:[]}},computed:{disableSubmit:function(){return 0===this.selectedSkuItemArray.length}},mounted:function(){this.getUserInfo()},methods:{updateHeader:function(){this.uploadHeader=Object.assign(this.uploadHeader,{Authorization:"Bearer "+O(T.ACCESS_TOKEN)})},submitFlowBtn:function(){if(console.log("submitFlow"),0===this.selectedSkuItemArray.length)return this.$Message.warning("请选择SKU"),!1;this.confirmModal.show=!0},submitFlow:function(){var t=this;this.confirmModal.loading=!0,Ut({sku:this.selectedSkuItemArray}).then((function(e){console.log(e),t.confirmModal.loading=!1,t.confirmModal.show=!1,t.$Message.success("创建成功"),t.selectedSkuItemArray=[],t.tableArr=[],t.showTable=!1}))},onExceedSize:function(){this.$Message.warning("上传文件大小最大10M")},uploadError:function(t,e,a){this.$Message.error(e.msg),console.log(t),console.log(e),console.log(a)},afterUpload:function(t,e,a){var o=this;this.showTable=!0,this.tableLoading=!0,setTimeout((function(){return o.tableLoading=!1}),1e3),this.tableArr=t.data,console.log(t),console.log(e),console.log(a)},getUserInfo:function(){var t,e,a=this,o=/code=.+/.exec(window.location.search);if(o){var n=o[0].split("&");t=n[0].split("=")[1],e=n[1].split("=")[1],login({code:t,state:e}).then((function(t){console.log(t),a.token=t.data.access_token;var e=t.data.access_token;E(T.ACCESS_TOKEN,e)}))}},downloadTemplate:function(){window.open(T.apiUrl+"/media/sample.xlsx","_blank")},selectAllCaption:function(t){console.log(t),this.selectAllTitle=this.selectAllCaptionChoice[Number(!t)]},handleSelectAll:function(){this.$refs.skuTable.selectAll()},onSelectSkuItem:function(t){console.log(t),this.selectedSkuItemArray=t}}}),zt=Bt,Ht=Object(l["a"])(zt,Ot,jt,!1,null,"82e706d2",null),Pt=Ht.exports,Wt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",{staticStyle:{margin:"auto","margin-top":"50px","min-height":"500px","margin-left":"50px","margin-right":"50px"},attrs:{"dis-hover":""}},[a("p",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.title))]),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.showTable,expression:"!showTable"}]},[a("Row",[a("Table",{staticStyle:{"margin-bottom":"10px"},attrs:{stripe:"",columns:t.columns,data:t.data,loading:t.listLoading},scopedSlots:t._u([{key:"action",fn:function(e){var o=e.row;return[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small",disabled:o.result},on:{click:function(e){return t.audit(o)}}},[t._v("审批")])]}}])}),a("Page",{attrs:{total:t.pagination.total,"page-size":t.pagination.num,current:t.pagination.page},on:{"on-change":t.changePage}})],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.showTable,expression:"showTable"}]},[a("Row",{staticStyle:{"margin-bottom":"5px"}},[a("Button",{attrs:{type:"default"},on:{click:function(e){return e.preventDefault(),t.back(e)}}},[t._v(" 返回 ")]),a("Dropdown",{staticStyle:{float:"right"},on:{"on-click":t.submitFlowBtn}},[a("Button",{attrs:{type:"primary"}},[t._v(" 审批 "),a("Icon",{attrs:{type:"ios-arrow-down"}})],1),a("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[a("DropdownItem",{attrs:{disabled:t.disableSubmit,name:"pass"}},[t._v("通过")]),a("DropdownItem",{attrs:{disabled:t.disableSubmit,name:"reject"}},[t._v("驳回")])],1)],1)],1),a("SkuTable",{ref:"selectedFlowTable",attrs:{data:t.selectedFlowTable,loading:t.tableLoading},on:{onSelect:t.onSelect}})],1),a("Modal",{ref:"confirmModal",attrs:{"mask-closable":!1,title:"操作提醒",loading:t.confirmModal.loading},on:{"on-ok":t.submitFlow},model:{value:t.confirmModal.show,callback:function(e){t.$set(t.confirmModal,"show",e)},expression:"confirmModal.show"}},[a("p",[t._v("确认将已选产品SKU执行操作?")]),a("Input",{directives:[{name:"show",rawName:"v-show",value:!t.action,expression:"!action"}],attrs:{type:"textarea",rows:4,placeholder:"(非必填)驳回意见"},model:{value:t.rejectReason,callback:function(e){t.rejectReason=e},expression:"rejectReason"}})],1)],1)},Xt=[],Yt={name:"ApplyList",components:{SkuTable:Nt},data:function(){return{total:100,confirmModal:{show:!1,loading:!0},pagination:{num:10,page:1,total:0},rejectReason:"",listLoading:!1,selectedFlow:null,action:null,actionSelectedSKU:[],selectedFlowTable:[],tableLoading:!1,columns:[{title:"发起人",key:"creator_name",align:"center"},{title:"处理状态",align:"center",key:"result",render:function(t,e){return console.log(e),t("div",[t("Tag",{props:{color:e.row.result?"green":"orange"}},e.row.result?"已处理":"未处理")])}},{title:"创建时间",key:"create_time",align:"center"},{title:"操作",slot:"action",align:"center"}],data:[]}},computed:{disableSubmit:function(){return 0===this.actionSelectedSKU.length},showTable:function(){return 0!==this.selectedFlowTable.length},title:function(){return 0===this.selectedFlowTable.length?"产品审批流程列表":"审批列表SKU"}},mounted:function(){var t=O(T.ACCESS_TOKEN);t?this.getData():(this.listLoading=!0,this.getUserInfo())},methods:{getUserInfo:function(){var t,e,a=this,o=/code=.+/.exec(window.location.search);if(o){var n=o[0].split("&");t=n[0].split("=")[1],e=n[1].split("=")[1],R({code:t,state:e}).then((function(t){console.log(t);var e=t.data.access_token;E(T.ACCESS_TOKEN,e),a.getData()}))}},onSelect:function(t){console.log(t),this.actionSelectedSKU=t},getData:function(){var t=this;this.listLoading=!0;var e={num:this.pagination.num,page:this.pagination.page};$t(e).then((function(e){console.log(e),t.data=e.results,t.pagination.total=e.count,setTimeout((function(){return t.listLoading=!1}),800)}))},back:function(){this.selectedFlowTable=[],this.actionSelectedSKU=[],this.rejectReason=""},audit:function(t){var e=this;this.tableLoading=!0,this.selectedFlow=t;var a=[];Mt(t.flow_id).then((function(t){console.log(t),t.data.skus.forEach((function(t){var e={result:t.is_pass,_disabled:t.is_pass};a.push(Object.assign(e,t.sku))})),e.selectedFlowTable=a,setTimeout((function(){return e.tableLoading=!1}),500)}))},submitFlowBtn:function(t){console.log(t),this.action="pass"===t,this.action,this.confirmModal.show=!0},submitFlow:function(){var t=this,e={is_accept:this.action,sku:this.actionSelectedSKU,memo:this.rejectReason};Kt(this.selectedFlow.flow_id,e).then((function(e){console.log(e),t.confirmModal.loading=!1,t.confirmModal.show=!1,t.$Message.success("审批完成"),t.getData(),t.back()}))},changePage:function(t){console.log(t),this.pagination.page=t,this.getData()}}},Jt=Yt,Vt=Object(l["a"])(Jt,Wt,Xt,!1,null,"52e12362",null),Qt=Vt.exports,Zt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",{staticStyle:{margin:"auto","margin-top":"50px","min-height":"500px","margin-left":"50px","margin-right":"50px"},attrs:{"dis-hover":""}},[a("p",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.title))]),a("a",{directives:[{name:"show",rawName:"v-show",value:!t.listLoading,expression:"!listLoading"}],attrs:{slot:"extra"},on:{click:function(e){return t.$router.push({name:"sku-flow"})}},slot:"extra"},[t._v("创建流程")]),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.showTable,expression:"!showTable"}]},[a("Row",[a("Table",{staticStyle:{"margin-bottom":"10px"},attrs:{stripe:"",columns:t.columns,data:t.data,loading:t.listLoading},scopedSlots:t._u([{key:"action",fn:function(e){var o=e.row;return[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.check(o)}}},[t._v("查看")])]}}])}),a("Page",{attrs:{total:t.pagination.total,"page-size":t.pagination.num,current:t.pagination.page},on:{"on-change":t.changePage}})],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.showTable,expression:"showTable"}]},[a("Steps",{staticStyle:{"margin-bottom":"15px"},attrs:{current:t.stepActive}},t._l(t.stepArr,(function(t,e){return a("Step",{key:e,attrs:{title:t.title,content:t.desc}})})),1),a("Row",{directives:[{name:"show",rawName:"v-show",value:t.rejectReason,expression:"rejectReason"}],staticClass:"result"},[a("div",{staticStyle:{"text-align":"center"}},[t._v("审批意见: "),a("span",{staticStyle:{color:"#f90","font-size":"16px","font-weight":"bold"}},[t._v(t._s(t.rejectReason))])])]),a("Row",{staticStyle:{"margin-bottom":"5px"}},[a("Button",{attrs:{type:"default"},on:{click:function(e){return e.preventDefault(),t.back(e)}}},[t._v(" 返回 ")]),a("Button",{directives:[{name:"show",rawName:"v-show",value:t.isDone&&!t.disableReSubmit,expression:"isDone && !disableReSubmit"}],staticStyle:{float:"right"},attrs:{type:"primary",disabled:t.disableReSubmit},on:{click:function(e){return e.preventDefault(),t.submitFlowBtn(e)}}},[t._v(" 重新提交 ")])],1),a("SkuTable",{ref:"selectedFlowTable",attrs:{result:!0,isDone:t.isDone,data:t.selectedFlowTable,loading:t.tableLoading},on:{onSelect:t.onSelect,onEdit:t.onEditSku}})],1),a("InfoDrawer",{ref:"infoDrawer",attrs:{showDrawer:t.showDrawer,formData:t.skuInfo},on:{submit:t.handleSubmit,toggleDrawer:t.toggleDrawer}}),a("Modal",{ref:"confirmModal",attrs:{"mask-closable":!1,title:"操作提示",loading:t.confirmModal.loading},on:{"on-ok":t.submitFlow},model:{value:t.confirmModal.show,callback:function(e){t.$set(t.confirmModal,"show",e)},expression:"confirmModal.show"}},[a("p",[t._v("确认将已选产品SKU发起审批流程?")])])],1)},te=[],ee=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Drawer",{attrs:{title:"编辑SKU信息",width:"720",closable:!1,"mask-closable":!1,styles:t.styles},model:{value:t.showDrawer,callback:function(e){t.showDrawer=e},expression:"showDrawer"}},[a("Form",{ref:"skuForm",attrs:{model:t.formData,rules:t.rule}},[a("Row",{attrs:{gutter:32}},[a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{label:"供应商","label-position":"top",prop:"supplier"}},[a("label",[a("Input",{attrs:{placeholder:""},model:{value:t.formData.supplier,callback:function(e){t.$set(t.formData,"supplier",e)},expression:"formData.supplier"}})],1)])],1),a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{label:"SKU","label-position":"top",prop:"sku"}},[a("label",[a("Input",{attrs:{placeholder:""},model:{value:t.formData.sku,callback:function(e){t.$set(t.formData,"sku",e)},expression:"formData.sku"}})],1)])],1)],1),a("Row",{attrs:{gutter:32}},[a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{label:"型号","label-position":"top",prop:"model"}},[a("label",[a("Input",{attrs:{placeholder:""},model:{value:t.formData.model,callback:function(e){t.$set(t.formData,"model",e)},expression:"formData.model"}})],1)])],1),a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{label:"名称","label-position":"top",prop:"title"}},[a("label",[a("Input",{attrs:{placeholder:""},model:{value:t.formData.title,callback:function(e){t.$set(t.formData,"title",e)},expression:"formData.title"}})],1)])],1)],1),a("Row",{attrs:{gutter:32}},[a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{label:"采购","label-position":"top",prop:"purchaser"}},[a("label",[a("Input",{attrs:{placeholder:""},model:{value:t.formData.purchaser,callback:function(e){t.$set(t.formData,"purchaser",e)},expression:"formData.purchaser"}})],1)])],1),a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{label:"需求单数量","label-position":"top",prop:"qty"}},[a("label",[a("InputNumber",{staticStyle:{width:"100%"},attrs:{max:1e6,min:1},model:{value:t.formData.qty,callback:function(e){t.$set(t.formData,"qty",e)},expression:"formData.qty"}})],1)])],1)],1),a("Row",{attrs:{gutter:32}},[a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{label:"含税单价","label-position":"top",prop:"price_with_tax"}},[a("label",[a("InputNumber",{staticStyle:{width:"100%"},attrs:{max:1e4,formatter:function(t){return("￥"+t).replace(/\B(?=(\d{3})+(?!\d))/g,",")},parser:function(t){return t.replace(/\$\s?|(,*)/g,"")}},model:{value:t.formData.price_with_tax,callback:function(e){t.$set(t.formData,"price_with_tax",e)},expression:"formData.price_with_tax"}})],1)])],1),a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{label:"含税金额","label-position":"top",prop:"amount_with_tax"}},[a("label",[a("InputNumber",{staticStyle:{width:"100%"},attrs:{max:1e4,formatter:function(t){return("￥"+t).replace(/\B(?=(\d{3})+(?!\d))/g,",")},parser:function(t){return t.replace(/\$\s?|(,*)/g,"")}},model:{value:t.formData.amount_with_tax,callback:function(e){t.$set(t.formData,"amount_with_tax",e)},expression:"formData.amount_with_tax"}})],1)])],1)],1),a("Row",{attrs:{gutter:32}},[a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{label:"可售天数","label-position":"top",prop:"sell_day"}},[a("InputNumber",{staticStyle:{width:"100%"},attrs:{max:1e3,min:0},model:{value:t.formData.sell_day,callback:function(e){t.$set(t.formData,"sell_day",e)},expression:"formData.sell_day"}})],1)],1),a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{label:"30天销量","label-position":"top",prop:"qty_within_30"}},[a("InputNumber",{staticStyle:{width:"100%"},attrs:{max:1e6,min:0},model:{value:t.formData.qty_within_30,callback:function(e){t.$set(t.formData,"qty_within_30",e)},expression:"formData.qty_within_30"}})],1)],1)],1),a("Row",{attrs:{gutter:32}},[a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{label:"库存","label-position":"top",prop:"inventory"}},[a("InputNumber",{staticStyle:{width:"100%"},attrs:{max:1e6,min:0},model:{value:t.formData.inventory,callback:function(e){t.$set(t.formData,"inventory",e)},expression:"formData.inventory"}})],1)],1),a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{label:"采购在途","label-position":"top",prop:"coming_inventory"}},[a("InputNumber",{staticStyle:{width:"100%"},attrs:{max:1e6,min:0},model:{value:t.formData.coming_inventory,callback:function(e){t.$set(t.formData,"coming_inventory",e)},expression:"formData.coming_inventory"}})],1)],1)],1),a("Row",{attrs:{gutter:32}},[a("Col",{attrs:{span:"8"}},[a("FormItem",{attrs:{label:"毛利率","label-position":"top",prop:"gross_profit_rate"}},[a("InputNumber",{staticStyle:{width:"100%"},attrs:{max:100,formatter:function(t){return t+"%"},parser:function(t){return t.replace("%","")}},model:{value:t.formData.gross_profit_rate,callback:function(e){t.$set(t.formData,"gross_profit_rate",e)},expression:"formData.gross_profit_rate"}})],1)],1),a("Col",{attrs:{span:"8"}},[a("FormItem",{attrs:{label:"客退率","label-position":"top",prop:"return_rate"}},[a("InputNumber",{staticStyle:{width:"100%"},attrs:{max:100,formatter:function(t){return t+"%"},parser:function(t){return t.replace("%","")}},model:{value:t.formData.return_rate,callback:function(e){t.$set(t.formData,"return_rate",e)},expression:"formData.return_rate"}})],1)],1),a("Col",{attrs:{span:"8"}},[a("FormItem",{attrs:{label:"是否新品","label-position":"top",prop:"is_new"}},[a("label",[a("RadioGroup",{staticStyle:{width:"100%"},attrs:{type:"button"},model:{value:t.formData.is_new,callback:function(e){t.$set(t.formData,"is_new",e)},expression:"formData.is_new"}},[a("Radio",{attrs:{label:"是"}},[t._v("是")]),a("Radio",{attrs:{label:"否"}},[t._v("否")])],1)],1)])],1)],1),a("FormItem",{attrs:{label:"备注","label-position":"top",prop:"memo"}},[a("label",[a("Input",{attrs:{type:"textarea",rows:4,placeholder:"简要描述"},model:{value:t.formData.memo,callback:function(e){t.$set(t.formData,"memo",e)},expression:"formData.memo"}})],1)])],1),a("div",{staticClass:"demo-drawer-footer"},[a("Button",{staticStyle:{"margin-right":"8px"},on:{click:t.toggle}},[t._v("取消")]),a("Button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("提交")])],1)],1)],1)},ae=[],oe={name:"InfoDrawer",props:{showDrawer:{type:Boolean,require:!1,default:!1},formData:{type:Object,require:!0,default:{}}},data:function(){return{styles:{height:"calc(100% - 55px)",overflow:"auto",paddingBottom:"53px",position:"static"},form:{id:null,supplier:"",sku:"",model:"",title:"",is_new:"",qty:0,price_with_tax:0,amount_with_tax:0,sell_day:12,qty_within_30:0,inventory:0,coming_inventory:0,gross_profit_rate:0,return_rate:0,memo:"",create_time:null,purchaser:""},rule:{supplier:[{required:!0,message:"请提供供应商名称"}],sku:[{required:!0,message:"请提供SKU"}],model:[{required:!0,message:"请提供SKU型号"}],title:[{required:!0,message:"请提供SKU名称"}],is_new:[{required:!0,message:"请确认是否为新品"}],qty:[{required:!0,message:"请提供需求单数量"}],price_with_tax:[{required:!0,message:"请提供含税单价"}],amount_with_tax:[{required:!0,message:"请提供含税总金额"}],sell_day:[{required:!0,message:"请提供可售天数"}],qty_within_30:[{required:!0,message:"请提供30天销量"}],inventory:[{required:!0,message:"请提供库存"}],coming_inventory:[{required:!0,message:"请提供采购在途"}],gross_profit_rate:[{required:!0,message:"请提供毛利率"}],return_rate:[{required:!0,message:"请提供客退率"}],memo:[{required:!0,message:"请提供备注"}],purchaser:[{required:!0,message:"请提供采购名称"}]}}},methods:{toggle:function(){this.$emit("toggleDrawer")},handleSubmit:function(){var t=this;console.log(this.formData),this.$refs["skuForm"].validate((function(e){console.log(e),e?t.$emit("submit",t.formData):t.$Message.error("表单验证失败")}))},resetForm:function(){this.$refs.skuForm.resetFields()}}},ne=oe,ie=(a("d111"),Object(l["a"])(ne,ee,ae,!1,null,null,null)),re=ie.exports,se={name:"SkuApply",components:{SkuTable:Nt,InfoDrawer:re},data:function(){return{total:100,isDone:!1,showDrawer:!1,confirmModal:{show:!1,loading:!0},stepActive:0,stepArr:[],token:"",pagination:{num:10,page:1,total:0},listLoading:!1,selectedFlow:null,action:null,rejectReason:"",actionSelectedFailedSKU:[],selectedFlowTable:[],tableLoading:!1,columns:[{title:"发起人",key:"creator_name",align:"center"},{title:"处理状态",align:"center",key:"is_done",render:function(t,e){return console.log(e),t("div",[t("Tag",{props:{color:e.row.is_done?"green":"orange"}},e.row.is_done?"已处理":"处理中")])}},{title:"创建时间",key:"create_time",align:"center"},{title:"操作",slot:"action",align:"center"}],data:[],skuInfo:{id:null,supplier:"",sku:"",model:"",title:"",is_new:"",qty:0,price_with_tax:0,amount_with_tax:0,sell_day:12,qty_within_30:0,inventory:0,coming_inventory:0,gross_profit_rate:0,return_rate:0,memo:"",create_time:null,purchaser:""}}},computed:{disableReSubmit:function(){return 0===this.actionSelectedFailedSKU.length},showTable:function(){return 0!==this.selectedFlowTable.length},title:function(){return 0===this.selectedFlowTable.length?"我的审批流程列表":"审批SKU列表"}},mounted:function(){var t=O(T.ACCESS_TOKEN);t?this.getData():(this.listLoading=!0,this.token=t,this.getUserInfo())},methods:{onSelect:function(t){console.log(t),this.actionSelectedFailedSKU=t},getData:function(){var t=this;this.listLoading=!0;var e={num:this.pagination.num,page:this.pagination.page};qt(e).then((function(e){console.log(e),t.data=e.results,t.pagination.total=e.count,setTimeout((function(){return t.listLoading=!1}),800)}))},back:function(){this.selectedFlowTable=[],this.rejectReason=""},getFlow:function(t){var e=this,a=[];Mt(t).then((function(t){console.log(t),t.data.skus.forEach((function(t){var e={result:t.is_pass,_disabled:t.is_pass};a.push(Object.assign(e,t.sku))})),e.isDone=t.data.is_done,e.selectedFlowTable=a,e.changeStep(t.data),setTimeout((function(){return e.tableLoading=!1}),500)}))},changeStep:function(t){var e=t.result;this.stepArr=[{title:"上传产品列表",desc:"使用模板填充产品列表",icon:"ios-cloud-upload",status:"finish"}];for(var a=0;a<e.length;a++){if("reject"===e[a].is_accept)return this.stepArr.push({title:"审批不通过（".concat(e[a].auditor,"）"),desc:"",icon:"ios-person",status:"error"}),this.stepActive=a,this.rejectReason=e[a].memo,!0;if("accept"===e[a].is_accept){var o={title:"审批（".concat(e[a].auditor,"）"),desc:"",icon:"ios-person",status:"finish"};this.stepArr.push(o)}else{var n={title:"审批（".concat(e[a].auditor,"）"),desc:"",icon:"ios-person",status:"wait"};this.stepArr.push(n),this.stepActive=a}}t.is_done?(this.stepArr.push({title:"申请流程通过",desc:"",icon:"md-checkmark-circle",status:"finish"}),this.stepActive=this.stepArr.length-1):this.stepArr.push({title:"审批结果",desc:"",icon:"md-lock",status:"wait"})},check:function(t){this.tableLoading=!0,this.selectedFlow=t,this.getFlow(t.id),console.log(t)},submitFlowBtn:function(t){if(console.log(t),0===this.actionSelectedFailedSKU.length)return this.$Message.error("请至少选择一个SKU发起流程"),!1;this.confirmModal.show=!0},submitFlow:function(){var t=this,e={sku:this.actionSelectedFailedSKU};Ut(e).then((function(e){console.log(e),t.confirmModal.loading=!1,t.confirmModal.show=!1,t.$Message.success("所选SKU已重新发起流程"),t.getData(),t.back()}))},changePage:function(t){console.log(t),this.pagination.page=t,this.getData()},toggleDrawer:function(){this.showDrawer=!this.showDrawer},onEditSku:function(t){this.showDrawer=!0,t.qty=Number(t.qty),t.price_with_tax=Number(t.price_with_tax),t.amount_with_tax=Number(t.amount_with_tax),t.sell_day=Number(t.sell_day),t.qty_within_30=Number(t.qty_within_30),t.inventory=Number(t.inventory),t.coming_inventory=Number(t.coming_inventory),t.gross_profit_rate=100*Number(t.gross_profit_rate),t.return_rate=100*Number(t.return_rate),this.skuInfo=t},handleSubmit:function(t){var e=this;t.gross_profit_rate=t.gross_profit_rate/100,t.return_rate=t.return_rate/100;var a=Object.assign(t,{flowID:this.selectedFlow.id});Gt(t.id,a).then((function(){e.getFlow(e.selectedFlow.id),e.$Message.success("SKU信息修改成功"),e.toggleDrawer(),e.$refs.infoDrawer.resetForm()}))},getUserInfo:function(){var t,e,a=this,o=/code=.+/.exec(window.location.search);if(o){var n=o[0].split("&");t=n[0].split("=")[1],e=n[1].split("=")[1],R({code:t,state:e}).then((function(t){console.log(t),a.token=t.data.access_token,E(T.ACCESS_TOKEN,t.data.access_token),a.getData()}))}}}},le=se,ce=Object(l["a"])(le,Zt,te,!1,null,"2ae171e7",null),ue=ce.exports,pe=[{path:"/product/flow",name:"product-flow",component:ot,meta:{title:"产品立项申请"}},{path:"/product/auditlist",name:"audit-list",component:ht,meta:{title:"产品立项列表"}},{path:"/product/audit/:projectID([1-9]\\d*)?",name:"product-audit",component:yt,meta:{title:"产品申请详情"}},{path:"/sku/flow",name:"sku-flow",component:Pt,meta:{title:"返单特采数据上传"}},{path:"/sku/auditlist",name:"sku-audit-list",component:Qt,meta:{title:"返单特采审核列表"}},{path:"/sku/history",name:"sku-apply",component:ue,meta:{title:"返单特采申请记录"}},{path:"*",name:"notFound",component:Et,meta:{title:"错误，请返回"}}];o["default"].use(p["a"]);var de=new p["a"]({mode:"history",routes:pe}),me=de,fe=a("c16e"),he=a.n(fe),ge=a("2f62"),_e="SIDEBAR_TYPE",ve="DEFAULT_THEME",be="DEFAULT_LAYOUT_MODE",we="DEFAULT_COLOR",ye="DEFAULT_COLOR_WEAK",ke="DEFAULT_FIXED_HEADER",Se="DEFAULT_FIXED_SIDEMENU",xe="DEFAULT_FIXED_HEADER_HIDDEN",De="DEFAULT_CONTENT_WIDTH_TYPE",Te="DEFAULT_MULTI_TAB",Ee={state:{sidebar:!0,device:"desktop",theme:"",layout:"",contentWidth:"",fixedHeader:!1,fixSiderbar:!1,autoHideHeader:!1,color:null,weak:!1,multiTab:!0},mutations:{SET_SIDEBAR_TYPE:function(t,e){t.sidebar=e,o["default"].ls.set(_e,e)},CLOSE_SIDEBAR:function(t){o["default"].ls.set(_e,!0),t.sidebar=!1},TOGGLE_DEVICE:function(t,e){t.device=e},TOGGLE_THEME:function(t,e){o["default"].ls.set(ve,e),t.theme=e},TOGGLE_LAYOUT_MODE:function(t,e){o["default"].ls.set(be,e),t.layout=e},TOGGLE_FIXED_HEADER:function(t,e){o["default"].ls.set(ke,e),t.fixedHeader=e},TOGGLE_FIXED_SIDERBAR:function(t,e){o["default"].ls.set(Se,e),t.fixSiderbar=e},TOGGLE_FIXED_HEADER_HIDDEN:function(t,e){o["default"].ls.set(xe,e),t.autoHideHeader=e},TOGGLE_CONTENT_WIDTH:function(t,e){o["default"].ls.set(De,e),t.contentWidth=e},TOGGLE_COLOR:function(t,e){o["default"].ls.set(we,e),t.color=e},TOGGLE_WEAK:function(t,e){o["default"].ls.set(ye,e),t.weak=e},TOGGLE_MULTI_TAB:function(t,e){o["default"].ls.set(Te,e),t.multiTab=e}},actions:{setSidebar:function(t,e){var a=t.commit;a("SET_SIDEBAR_TYPE",e)},CloseSidebar:function(t){var e=t.commit;e("CLOSE_SIDEBAR")},ToggleDevice:function(t,e){var a=t.commit;a("TOGGLE_DEVICE",e)},ToggleTheme:function(t,e){var a=t.commit;a("TOGGLE_THEME",e)},ToggleLayoutMode:function(t,e){var a=t.commit;a("TOGGLE_LAYOUT_MODE",e)},ToggleFixedHeader:function(t,e){var a=t.commit;e||a("TOGGLE_FIXED_HEADER_HIDDEN",!1),a("TOGGLE_FIXED_HEADER",e)},ToggleFixSiderbar:function(t,e){var a=t.commit;a("TOGGLE_FIXED_SIDERBAR",e)},ToggleFixedHeaderHidden:function(t,e){var a=t.commit;a("TOGGLE_FIXED_HEADER_HIDDEN",e)},ToggleContentWidth:function(t,e){var a=t.commit;a("TOGGLE_CONTENT_WIDTH",e)},ToggleColor:function(t,e){var a=t.commit;a("TOGGLE_COLOR",e)},ToggleWeak:function(t,e){var a=t.commit;a("TOGGLE_WEAK",e)},ToggleMultiTab:function(t,e){var a=t.commit;a("TOGGLE_MULTI_TAB",e)}}},Oe=Ee,je={state:{token:"",refresh:"",name:"",info:{}},mutations:{SET_TOKEN:function(t,e){t.token=e},SET_REFRESH_TOKEN:function(t,e){t.refresh=e},SET_INFO:function(t,e){t.info=e}},actions:{Login:function(t,e){t.commit;return new Promise((function(t,a){R(e).then((function(e){setUserToken(e.data.access_token,e.data.refresh_token),t()})).catch((function(t){a(t)}))}))}}},Fe=je,Ie={token:function(t){return t.user.token},userInfo:function(t){return t.user.info}},Ae=Ie;o["default"].use(ge["a"]);var Ce=new ge["a"].Store({modules:{app:Oe,user:Fe},state:{},mutations:{},actions:{},getters:Ae}),Le=a("a244"),Ne=a.n(Le);a("fcad");o["default"].use(Ne.a),o["default"].use(he.a,T.storageOptions),o["default"].config.productionTip=!1,new o["default"]({router:me,store:Ce,components:{App:u},render:function(t){return t(u)}}).$mount("#app")},"5dd3":function(t,e,a){},"6f98":function(t,e,a){"use strict";var o=a("77c6"),n=a.n(o);n.a},"753b":function(t,e,a){"use strict";var o=a("5dd3"),n=a.n(o);n.a},"77c6":function(t,e,a){},"85ec":function(t,e,a){},b444:function(t,e,a){},d111:function(t,e,a){"use strict";var o=a("0bd5"),n=a.n(o);n.a},dbac:function(t,e,a){"use strict";var o=a("b444"),n=a.n(o);n.a}});